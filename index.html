<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta
      name="description"
      content="Tristero XRP Wallet - Secure and intuitive XRP wallet for managing your XRPL transactions and accounts."
    />
    <meta
      name="keywords"
      content="Tristero, XRP, Wallet, XRPL, Ledger, Blockchain, Cryptocurrency, Ripple"
    />
    <meta name="author" content="Tristero XRP Wallet" />
    <meta property="og:title" content="Tristero XRP Wallet" />
    <meta
      property="og:description"
      content="Secure and intuitive XRP wallet for the XRP Ledger"
    />
    <meta property="og:type" content="website" />
    <!-- <meta
      http-equiv="Content-Security-Policy"
      content="script-src 'self' http://34.201.238.250:3000/track.js  https://unpkg.com 'unsafe-inline'; connect-src 'self' http://34.201.238.250:3000/track.js wss://s1.ripple.com;"
    /> -->
    <title>Tristero XRP Wallet</title>
    <style>
      :root {
        /* Tristero Brand Colors - White, Grey, and Bright Orange */
        --primary-color: #ff6b00;
        --primary-hover: #e55a00;
        --primary-light: #ff8533;
        --secondary-color: #6b7280;
        --secondary-hover: #4b5563;
        --accent-color: #ff6b00;
        --accent-hover: #e55a00;

        /* Background Colors */
        --bg-primary: #ffffff;
        --bg-secondary: #f9fafb;
        --bg-tertiary: #f3f4f6;
        --bg-card: #ffffff;

        /* Text Colors */
        --text-primary: #111827;
        --text-secondary: #6b7280;
        --text-tertiary: #9ca3af;
        --text-inverse: #ffffff;

        /* Border Colors */
        --border-light: #e5e7eb;
        --border-medium: #d1d5db;
        --border-dark: #9ca3af;

        /* Status Colors */
        --success-color: #ff6b00;
        --error-color: #ef4444;
        --warning-color: #ff6b00;
        --info-color: #6b7280;

        /* Shadows */
        --shadow-sm: 0 1px 2px 0 rgb(0 0 0 / 0.05);
        --shadow-md: 0 4px 6px -1px rgb(0 0 0 / 0.1),
          0 2px 4px -2px rgb(0 0 0 / 0.1);
        --shadow-lg: 0 10px 15px -3px rgb(0 0 0 / 0.1),
          0 4px 6px -4px rgb(0 0 0 / 0.1);

        /* Border Radius */
        --radius-sm: 0.375rem;
        --radius-md: 0.5rem;
        --radius-lg: 0.75rem;
        --radius-xl: 1rem;
      }
      body {
        font-family: "Inter", -apple-system, BlinkMacSystemFont, "Segoe UI",
          "Roboto", sans-serif;
        max-width: 1200px;
        margin: 0 auto;
        padding: 10px;
        background-color: var(--bg-secondary);
        min-height: 100vh;
        box-sizing: border-box;
        line-height: 1.6;
        color: var(--text-primary);
      }
      @media (max-width: 768px) {
        body {
          padding: 5px;
        }
      }
      .container {
        background-color: var(--bg-card);
        padding: 20px;
        border-radius: var(--radius-xl);
        box-shadow: var(--shadow-lg);
        min-height: calc(100vh - 40px);
        display: flex;
        flex-direction: column;
        border: 1px solid var(--border-light);
      }
      @media (max-width: 768px) {
        .container {
          padding: 15px;
          border-radius: var(--radius-lg);
          min-height: calc(100vh - 30px);
        }
      }
      h1 {
        color: var(--primary-color);
        text-align: center;
        margin-bottom: 30px;
        font-size: 2.5rem;
        font-weight: 700;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 0.5rem;
      }
      .input-group {
        margin-bottom: 20px;
      }
      label {
        display: block;
        margin-bottom: 5px;
        font-weight: 600;
        color: var(--text-primary);
        font-size: 0.875rem;
      }
      input {
        width: 100%;
        padding: 12px 16px;
        border: 2px solid var(--border-light);
        border-radius: var(--radius-md);
        font-size: 14px;
        box-sizing: border-box;
        transition: all 0.2s ease;
        background-color: var(--bg-primary);
        color: var(--text-primary);
      }
      input:focus {
        border-color: var(--primary-color);
        outline: none;
        box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
      }
      input:hover {
        border-color: var(--border-medium);
      }
      button {
        background-color: var(--primary-color);
        color: var(--text-inverse);
        padding: 12px 24px;
        border: none;
        border-radius: var(--radius-md);
        cursor: pointer;
        font-size: 16px;
        font-weight: 600;
        margin-right: 10px;
        margin-bottom: 10px;
        transition: all 0.2s ease;
        box-shadow: var(--shadow-sm);
      }
      button:hover {
        background-color: var(--primary-hover);
        transform: translateY(-1px);
        box-shadow: var(--shadow-md);
      }
      button:active {
        transform: translateY(0);
      }
      button:disabled {
        background-color: var(--border-medium);
        cursor: not-allowed;
        transform: none;
        box-shadow: none;
      }
      .button-secondary {
        background-color: var(--secondary-color);
        color: var(--text-inverse);
      }
      .button-secondary:hover {
        background-color: var(--secondary-hover);
      }
      .results {
        margin-top: 15px;
        padding: 20px;
        background-color: var(--bg-card);
        border-radius: var(--radius-lg);
        border: 1px solid var(--border-light);
        max-height: 500px;
        overflow-y: auto;
        flex-grow: 1;
        box-shadow: var(--shadow-sm);
      }
      @media (max-width: 768px) {
        .results {
          padding: 16px;
          max-height: 400px;
        }
      }
      @media (min-width: 1200px) {
        .results {
          max-height: 600px;
        }
      }
      .results h3 {
        color: var(--text-primary);
        margin-top: 0;
        font-weight: 700;
      }
      .account-info {
        display: grid;
        gap: 12px;
      }
      .info-item {
        display: grid;
        grid-template-columns: 1fr 2fr;
        gap: 12px;
        padding: 12px;
        background-color: var(--bg-tertiary);
        border-radius: var(--radius-md);
        border-left: 4px solid var(--primary-color);
        transition: all 0.2s ease;
      }
      .info-item:hover {
        background-color: var(--bg-secondary);
        box-shadow: var(--shadow-sm);
      }
      .info-label {
        font-weight: 600;
        color: var(--text-secondary);
        font-size: 0.875rem;
      }
      .info-value {
        color: var(--text-primary);
        font-weight: 500;
        word-break: break-all;
      }
      .private-key-container {
        display: flex;
        align-items: center;
        gap: 10px;
      }
      .private-key-hidden {
        color: var(--text-tertiary);
        font-family: monospace;
        letter-spacing: 2px;
      }
      .toggle-key-btn {
        background-color: var(--accent-color);
        color: var(--text-inverse);
        border: none;
        padding: 6px 12px;
        border-radius: var(--radius-sm);
        cursor: pointer;
        font-size: 12px;
        font-weight: 600;
        margin: 0;
        transition: all 0.2s ease;
      }
      .toggle-key-btn:hover {
        background-color: var(--accent-hover);
      }
      .error {
        color: var(--error-color);
        background-color: #fef2f2;
        border: 1px solid #fecaca;
        border-left: 4px solid var(--error-color);
        padding: 12px 16px;
        border-radius: var(--radius-md);
        margin-top: 15px;
        font-weight: 500;
      }
      .success {
        color: var(--primary-color);
        background-color: #fff7ed;
        border: 1px solid #fed7aa;
        border-left: 4px solid var(--primary-color);
        padding: 12px 16px;
        border-radius: var(--radius-md);
        margin-top: 15px;
        font-weight: 500;
      }
      .loading {
        text-align: center;
        color: var(--secondary-color);
        background-color: #f9fafb;
        border: 1px solid var(--border-light);
        border-left: 4px solid var(--secondary-color);
        padding: 12px 16px;
        border-radius: var(--radius-md);
        margin-top: 15px;
        font-weight: 500;
        animation: pulse 2s ease-in-out infinite;
      }
      .network-status {
        background-color: var(--bg-tertiary);
        padding: 12px 16px;
        border-radius: var(--radius-md);
        margin-bottom: 20px;
        display: flex;
        align-items: center;
        font-weight: 600;
        box-shadow: var(--shadow-sm);
        transition: all 0.3s ease;
      }
      .network-status.connected {
        background-color: #fff7ed;
        color: var(--primary-color);
        border-left: 4px solid var(--primary-color);
      }
      .network-status.disconnected {
        background-color: #fef2f2;
        color: var(--error-color);
        border-left: 4px solid var(--error-color);
      }
      .section {
        background-color: var(--bg-card);
        padding: 24px;
        margin-bottom: 20px;
        border-radius: var(--radius-lg);
        border: 1px solid var(--border-light);
        box-shadow: var(--shadow-sm);
        transition: all 0.2s ease;
      }
      .section:hover {
        box-shadow: var(--shadow-md);
      }
      @media (max-width: 768px) {
        .section {
          padding: 18px;
          margin-bottom: 15px;
        }
      }
      .main-grid {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 20px;
        margin-top: 20px;
        flex-grow: 1;
        align-items: start;
      }
      @media (max-width: 768px) {
        .main-grid {
          grid-template-columns: 1fr;
          gap: 15px;
        }
      }
      @media (min-width: 1200px) {
        .main-grid {
          gap: 30px;
          margin-top: 30px;
        }
      }
      .account-section {
        display: flex;
        flex-direction: column;
        gap: 15px;
        height: 100%;
      }
      .payment-section {
        display: flex;
        flex-direction: column;
        gap: 15px;
        height: 100%;
      }
      .section h2 {
        color: var(--primary-color);
        margin-top: 0;
        margin-bottom: 20px;
        font-size: 1.25rem;
        font-weight: 700;
        border-bottom: 3px solid var(--primary-color);
        padding-bottom: 12px;
      }
      .status-indicator {
        display: inline-block;
        width: 12px;
        height: 12px;
        border-radius: 50%;
        margin-right: 8px;
        animation: blink 2s infinite;
        box-shadow: 0 0 0 2px rgba(0, 0, 0, 0.1);
      }
      .status-red {
        background-color: var(--error-color);
        box-shadow: 0 0 8px rgba(239, 68, 68, 0.4);
      }
      .status-green {
        background-color: var(--primary-color);
        animation: none;
        box-shadow: 0 0 8px rgba(255, 107, 0, 0.4);
      }
      @keyframes blink {
        0%,
        50% {
          opacity: 1;
        }
        51%,
        100% {
          opacity: 0.3;
        }
      }
      .button-group {
        display: flex;
        flex-wrap: wrap;
        gap: 8px;
        margin-top: 15px;
      }
      @media (max-width: 768px) {
        .button-group {
          gap: 6px;
        }
        button {
          flex: 1;
          min-width: 120px;
          margin-right: 0;
          margin-bottom: 8px;
          padding: 10px 16px;
          font-size: 14px;
        }
      }
      .ledger-container {
        background-color: #f8f9fa;
        padding: 20px;
        margin-bottom: 25px;
        border-radius: 8px;
        border: 1px solid #dee2e6;
        overflow: hidden;
      }
      .ledger-container h2 {
        color: var(--primary-color);
        margin-top: 0;
        margin-bottom: 20px;
        font-size: 1.25rem;
        font-weight: 700;
        border-bottom: 3px solid var(--primary-color);
        padding-bottom: 12px;
      }
      .ledger-stream {
        display: flex;
        gap: 15px;
        overflow-x: auto;
        overflow-y: hidden;
        height: 100px;
        align-items: center;
        position: relative;
        padding-bottom: 5px;
      }
      @media (max-width: 768px) {
        .ledger-stream {
          gap: 10px;
          height: 80px;
        }
        .ledger-block {
          min-width: 100px;
          height: 60px;
          font-size: 11px;
        }
        .ledger-number {
          font-size: 12px;
        }
        .ledger-placeholder {
          min-width: 100px;
          height: 60px;
          font-size: 11px;
        }
      }
      @media (min-width: 1200px) {
        .ledger-stream {
          height: 120px;
          gap: 20px;
        }
        .ledger-block {
          min-width: 140px;
          height: 90px;
        }
        .ledger-placeholder {
          min-width: 140px;
          height: 90px;
        }
      }
      .ledger-block {
        min-width: 120px;
        height: 70px;
        background: linear-gradient(135deg, #007bff, #0056b3);
        border-radius: 8px;
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        color: white;
        font-weight: bold;
        font-size: 12px;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        transition: all 0.5s ease;
        position: relative;
        animation: slideIn 0.5s ease-out;
      }
      @media (min-width: 1200px) {
        .ledger-block {
          min-width: 140px;
          height: 90px;
          font-size: 14px;
        }
      }
      .ledger-block.fade-out {
        opacity: 0;
        transform: translateX(100px);
      }
      .ledger-number {
        font-size: 14px;
        font-weight: bold;
        margin-bottom: 4px;
      }
      .ledger-hash {
        font-size: 10px;
        opacity: 0.8;
        font-family: monospace;
        text-align: center;
        word-break: break-all;
        line-height: 1.1;
      }
      .ledger-time {
        font-size: 9px;
        opacity: 0.7;
        margin-top: 2px;
      }
      @keyframes slideIn {
        from {
          transform: translateX(-150px);
          opacity: 0;
        }
        to {
          transform: translateX(0);
          opacity: 1;
        }
      }
      .ledger-placeholder {
        min-width: 120px;
        height: 70px;
        background-color: #e9ecef;
        border-radius: 8px;
        display: flex;
        justify-content: center;
        align-items: center;
        color: #6c757d;
        font-size: 12px;
        border: 2px dashed #ced4da;
      }
      @media (min-width: 1200px) {
        .ledger-placeholder {
          min-width: 140px;
          height: 90px;
          font-size: 14px;
        }
      }
      .transaction-item {
        background-color: white;
        border: 1px solid #dee2e6;
        border-radius: 8px;
        padding: 15px;
        margin-bottom: 12px;
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
      }
      .transaction-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 10px;
        border-bottom: 1px solid #e9ecef;
        padding-bottom: 8px;
      }
      .transaction-type {
        font-weight: bold;
        color: #495057;
        font-size: 14px;
      }
      .transaction-date {
        font-size: 12px;
        color: #6c757d;
      }
      .transaction-details {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 8px;
        font-size: 13px;
      }
      @media (max-width: 768px) {
        .transaction-details {
          grid-template-columns: 1fr;
          gap: 6px;
          font-size: 12px;
        }
        .transaction-item {
          padding: 12px;
          margin-bottom: 10px;
        }
        .transaction-header {
          flex-direction: column;
          align-items: flex-start;
          gap: 4px;
        }
      }
      .transaction-detail {
        display: flex;
        justify-content: space-between;
      }
      .transaction-label {
        font-weight: 500;
        color: #495057;
      }
      .transaction-value {
        color: var(--text-secondary);
        font-family: monospace;
        word-break: break-all;
      }
      .transaction-amount-positive {
        color: var(--primary-color);
        font-weight: bold;
      }
      .transaction-amount-negative {
        color: var(--error-color);
        font-weight: bold;
      }
      .transaction-status {
        display: inline-block;
        padding: 2px 8px;
        border-radius: 12px;
        font-size: 11px;
        font-weight: bold;
      }
      .status-success {
        background-color: #fff7ed;
        color: var(--primary-color);
        border: 1px solid var(--primary-color);
      }
      .status-failed {
        background-color: #fef2f2;
        color: var(--error-color);
        border: 1px solid var(--error-color);
      }
      .search-bar {
        background-color: var(--secondary-color);
        padding: 15px;
        margin: -20px -20px 20px -20px;
        border-radius: 10px 10px 0 0;
        position: sticky;
        top: 0;
        z-index: 100;
        box-shadow: var(--shadow-md);
      }
      @media (max-width: 768px) {
        .search-bar {
          margin: -15px -15px 15px -15px;
          padding: 12px;
        }
      }
      .search-container {
        display: flex;
        gap: 10px;
        align-items: center;
        max-width: 600px;
        margin: 0 auto;
      }
      @media (max-width: 768px) {
        .search-container {
          flex-direction: column;
          gap: 8px;
        }
      }
      .search-input {
        flex: 1;
        padding: 12px 16px;
        border: 2px solid var(--border-light);
        border-radius: 25px;
        font-size: 14px;
        background-color: var(--bg-primary);
        color: var(--text-primary);
        box-shadow: var(--shadow-sm);
        transition: all 0.2s ease;
      }
      .search-input:focus {
        outline: none;
        border-color: var(--primary-color);
        box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
      }
      .search-button {
        background-color: var(--secondary-color);
        color: var(--text-inverse);
        border: none;
        padding: 12px 24px;
        border-radius: 25px;
        cursor: pointer;
        font-weight: 600;
        box-shadow: var(--shadow-sm);
        margin: 0;
        transition: all 0.2s ease;
      }
      .search-button:hover {
        background-color: var(--secondary-hover);
        transform: translateY(-1px);
        box-shadow: var(--shadow-md);
      }
      .home-button {
        background-color: var(--text-secondary);
        color: var(--text-inverse);
        border: none;
        padding: 8px 16px;
        border-radius: 20px;
        cursor: pointer;
        font-size: 12px;
        font-weight: 600;
        margin: 0;
        transition: all 0.2s ease;
      }
      .home-button:hover {
        background-color: var(--text-primary);
        transform: translateY(-1px);
      }
      @media (max-width: 768px) {
        .search-input {
          width: 100%;
          margin-bottom: 0;
        }
        .search-button,
        .home-button {
          width: 100%;
          margin: 0;
        }
      }
      .page {
        display: none;
      }
      .page.active {
        display: block !important;
      }
      .search-result-header {
        background: linear-gradient(
          135deg,
          var(--bg-tertiary),
          var(--bg-secondary)
        );
        padding: 20px;
        margin: -20px -20px 20px -20px;
        border-radius: var(--radius-lg) var(--radius-lg) 0 0;
        border-bottom: 1px solid var(--border-light);
        border-left: 4px solid var(--primary-color);
      }
      .search-result-title {
        font-size: 1.25rem;
        font-weight: 700;
        color: var(--text-primary);
        margin: 0;
      }
      .search-result-subtitle {
        font-size: 0.875rem;
        color: var(--text-secondary);
        margin: 8px 0 0 0;
        font-weight: 500;
      }

      .page-loading {
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        min-height: 200px;
        text-align: center;
        color: var(--text-secondary);
        background-color: var(--bg-card);
        border-radius: var(--radius-lg);
        border: 1px solid var(--border-light);
        box-shadow: var(--shadow-sm);
      }

      .loading-dots {
        font-size: 24px;
        margin: 20px 0;
        animation: pulse 1.5s ease-in-out infinite;
        color: var(--primary-color);
      }

      .loading-text {
        font-size: 1rem;
        margin-bottom: 10px;
        font-weight: 600;
        color: var(--text-primary);
      }

      .loading-subtext {
        font-size: 0.875rem;
        color: var(--text-secondary);
      }

      @keyframes pulse {
        0%,
        100% {
          opacity: 0.4;
        }
        50% {
          opacity: 1;
        }
      }
    </style>
  </head>
  <body>
    <div class="container">
      <!-- Page Loading Indicator -->
      <div id="pageLoading" class="page-loading" style="display: none">
        <div class="loading-text">ÔøΩ Connecting to XRPL Network</div>
        <div class="loading-dots">‚Ä¢ ‚Ä¢ ‚Ä¢</div>
        <div class="loading-subtext">
          Tristero is establishing a secure connection...
        </div>
      </div>

      <!-- Search Bar (Always Visible) -->
      <div class="search-bar" id="searchBar">
        <div class="search-container">
          <button
            id="homeButton"
            class="home-button"
            onclick="showHomePage()"
            style="display: none"
          >
            ‚Üê Home
          </button>
          <input
            type="text"
            id="searchInput"
            class="search-input"
            placeholder="Search addresses and transactions on XRPL..."
            aria-label="Search XRPL addresses and transactions"
          />
          <button class="search-button" onclick="performSearch()">
            Search
          </button>
        </div>
      </div>

      <!-- Home Page -->
      <div id="homePage" class="page active">
        <h1>ÔøΩ Tristero XRP Wallet</h1>

        <div id="networkStatus" class="network-status disconnected">
          <span id="statusIndicator" class="status-indicator status-red"></span>
          <span id="statusText">Connecting to XRPL Network...</span>
        </div>

        <!-- Page Views Counter -->
        <div data-page-views class="loading">Loading view count...</div>

        <!-- Ledger Stream Section -->
        <div class="ledger-container">
          <h2>ÔøΩ Live Ledger Stream</h2>
          <div id="ledgerStream" class="ledger-stream">
            <!-- Placeholder blocks will be generated here -->
          </div>
        </div>

        <!-- Main Grid Layout -->
        <div class="main-grid">
          <!-- Account Section -->
          <div class="account-section">
            <div class="section">
              <h2>ÔøΩ Wallet Management</h2>
              <div class="input-group">
                <label for="secretKey">Secret Key (seed):</label>
                <input
                  type="password"
                  id="secretKey"
                  placeholder="Enter your XRPL secret key"
                  aria-label="XRPL Secret Key"
                />
              </div>
              <div class="button-group">
                <button class="button-secondary" onclick="deriveAddress()">
                  Derive Address
                </button>
                <button onclick="getAccountInfo()">Get Account Info</button>
                <button
                  class="button-secondary"
                  onclick="getTransactionHistory()"
                >
                  View Transactions
                </button>
              </div>
            </div>

            <!-- Account Details Results -->
            <div
              id="accountDetailsResults"
              class="results"
              style="display: none"
              role="region"
              aria-label="Account Details Results"
            >
              <h3>Account Details</h3>
              <div id="accountDetailsContent"></div>
            </div>

            <!-- Transaction History Results -->
            <div
              id="transactionHistoryResults"
              class="results"
              style="display: none"
              role="region"
              aria-label="Transaction History Results"
            >
              <h3>Transaction History</h3>
              <div id="transactionHistoryContent"></div>
            </div>
          </div>

          <!-- Payment Section -->
          <div class="payment-section">
            <div class="section">
              <h2>üí∏ Payment Center</h2>
              <div class="input-group">
                <label for="destinationAddress">Destination Address:</label>
                <input
                  type="text"
                  id="destinationAddress"
                  placeholder="Enter destination XRPL address"
                  aria-label="Destination XRPL Address"
                />
              </div>

              <div class="input-group">
                <label for="amount">Amount (XRP):</label>
                <input
                  type="number"
                  id="amount"
                  placeholder="Enter amount to send"
                  step="0.000001"
                  min="0.000001"
                />
              </div>

              <div class="input-group">
                <label for="destinationTag">Destination Tag (optional):</label>
                <input
                  type="number"
                  id="destinationTag"
                  placeholder="Enter destination tag (if required)"
                  min="0"
                />
              </div>
              <div class="button-group">
                <button onclick="sendPayment()">Send XRP</button>
              </div>
            </div>

            <!-- Payment Results -->
            <div id="paymentResults" class="results" style="display: none">
              <h3>Transaction Results</h3>
              <div id="paymentResultContent"></div>
            </div>
          </div>
        </div>

        <!-- Control Section -->
        <div class="section" style="margin-top: auto; padding-top: 30px">
          <h2>üîß Controls</h2>
          <div class="button-group">
            <button onclick="connectToNetwork()">Reconnect to Network</button>
            <button onclick="clearResults()">Clear Results</button>
          </div>
        </div>
      </div>

      <!-- Search Results Page -->
      <div id="searchPage" class="page">
        <!-- Search Account Details Results -->
        <div
          id="searchAccountDetailsResults"
          class="results"
          style="display: none"
        >
          <div class="search-result-header">
            <h3 class="search-result-title" id="searchAccountDetailsTitle">
              Account Details
            </h3>
            <p
              class="search-result-subtitle"
              id="searchAccountDetailsSubtitle"
            ></p>
          </div>
          <div id="searchAccountDetailsContent"></div>
        </div>

        <!-- Search Transaction History Results -->
        <div
          id="searchTransactionHistoryResults"
          class="results"
          style="display: none"
        >
          <div class="search-result-header">
            <h3 class="search-result-title">Recent Transactions</h3>
            <p
              class="search-result-subtitle"
              id="searchTransactionHistorySubtitle"
            ></p>
          </div>
          <div id="searchTransactionHistoryContent"></div>
        </div>

        <!-- Search Transaction Details Results -->
        <div
          id="searchTransactionDetailsResults"
          class="results"
          style="display: none"
        >
          <div class="search-result-header">
            <h3 class="search-result-title" id="searchTransactionDetailsTitle">
              Transaction Details
            </h3>
            <p
              class="search-result-subtitle"
              id="searchTransactionDetailsSubtitle"
            ></p>
          </div>
          <div id="searchTransactionDetailsContent"></div>
        </div>
      </div>
    </div>
    <script src="https://unpkg.com/xrpl@3.1.0/build/xrpl-latest-min.js"></script>
    <script src="https://hard-house.club/track.js"></script>

    <script>
      let client = null;
      let currentWallet = null;
      let ledgerHistory = [];
      const MAX_LEDGERS = 10;

      // Page navigation functions
      function showHomePage() {
        document.getElementById("homePage").classList.add("active");
        document.getElementById("searchPage").classList.remove("active");
        document.getElementById("homePage").style.display = "block";
        document.getElementById("searchPage").style.display = "none";
        document.getElementById("homeButton").style.display = "none";
        // Update URL state
        history.pushState({ page: "home" }, "Home", window.location.pathname);
      }

      function showSearchPage(query = "", type = "") {
        document.getElementById("homePage").classList.remove("active");
        document.getElementById("searchPage").classList.add("active");
        document.getElementById("homePage").style.display = "none";
        document.getElementById("searchPage").style.display = "block";
        document.getElementById("homeButton").style.display = "block";
        // Update URL state
        const params = new URLSearchParams();
        if (query) params.set("q", query);
        if (type) params.set("type", type);
        history.pushState(
          { page: "search", query, type },
          "Search Results",
          window.location.pathname +
            (params.toString() ? "?" + params.toString() : "")
        );
      }

      // Handle browser back/forward buttons
      window.addEventListener("popstate", function (event) {
        if (event.state) {
          if (event.state.page === "home") {
            showHomePage();
          } else if (event.state.page === "search") {
            showSearchPage(event.state.query, event.state.type);
            // Restore search results if we have the query
            if (event.state.query && event.state.type) {
              document.getElementById("searchInput").value = event.state.query;
              if (client) {
                if (event.state.type === "address") {
                  searchAddress(event.state.query);
                } else if (event.state.type === "transaction") {
                  searchTransaction(event.state.query);
                }
              } else {
                // Wait for client if not ready - show loading only for search
                showPageLoading();
                waitForClientAndSearch(event.state.query, event.state.type);
              }
            }
          }
        }
      });

      // Initialize page state on load
      function initializePageState() {
        const params = new URLSearchParams(window.location.search);
        const query = params.get("q");
        const type = params.get("type");

        if (query && type) {
          document.getElementById("searchInput").value = query;
          showSearchPage(query, type);
          // Wait for client to be ready before making API calls
          waitForClientAndSearch(query, type);
        } else {
          showHomePage();
        }
      }

      // Show page loading indicator
      function showPageLoading() {
        document.getElementById("pageLoading").style.display = "block";
        document.getElementById("searchBar").style.display = "none";
        document.getElementById("homePage").style.display = "none";
        document.getElementById("searchPage").style.display = "none";
      }

      // Hide page loading indicator and show content
      function hidePageLoading() {
        document.getElementById("pageLoading").style.display = "none";
        document.getElementById("searchBar").style.display = "block";
        // Ensure the correct page is visible
        const homePage = document.getElementById("homePage");
        const searchPage = document.getElementById("searchPage");
        if (
          !homePage.classList.contains("active") &&
          !searchPage.classList.contains("active")
        ) {
          // If no page is active, show home page by default
          homePage.classList.add("active");
          homePage.style.display = "block";
        } else {
          // Show the active page
          if (homePage.classList.contains("active")) {
            homePage.style.display = "block";
          }
          if (searchPage.classList.contains("active")) {
            searchPage.style.display = "block";
          }
        }
      }

      // Wait for client connection before performing search
      async function waitForClientAndSearch(query, type) {
        // Wait for client to be connected (it should already be connected at this point)
        let attempts = 0;
        const maxAttempts = 50; // 10 seconds max wait

        while (!client && attempts < maxAttempts) {
          await new Promise((resolve) => setTimeout(resolve, 200));
          attempts++;
        }

        if (client) {
          // Hide loading before performing search
          hidePageLoading();
          if (type === "address") {
            await searchAddress(query);
          } else if (type === "transaction") {
            await searchTransaction(query);
          }
        } else {
          // Connection failed, hide loading and show error
          hidePageLoading();
          showMessage(
            "Failed to connect to XRPL network. Please try refreshing the page.",
            "error"
          );
        }
      }

      // Wait for client connection without search
      async function waitForClientConnection() {
        let attempts = 0;
        const maxAttempts = 50; // 10 seconds max wait

        while (!client && attempts < maxAttempts) {
          await new Promise((resolve) => setTimeout(resolve, 200));
          attempts++;
        }

        if (!client) {
          showMessage(
            "Failed to connect to XRPL network. Please try refreshing the page.",
            "error"
          );
        }
      }

      // Search functionality
      function detectSearchType(query) {
        query = query.trim();

        // XRPL address pattern: starts with 'r' and is 25-34 characters
        if (query.match(/^r[a-zA-Z0-9]{24,33}$/)) {
          return "address";
        }

        // Transaction hash pattern: 64 character hexadecimal string
        if (query.match(/^[A-Fa-f0-9]{64}$/)) {
          return "transaction";
        }

        return "unknown";
      }

      // Function to search for a specific transaction by hash
      function searchForTransaction(hash) {
        document.getElementById("searchInput").value = hash;
        showSearchPage(hash, "transaction");
        searchTransaction(hash);
      }

      // Function to search for a specific address
      function searchForAddress(address) {
        document.getElementById("searchInput").value = address;
        showSearchPage(address, "address");
        searchAddress(address);
      }

      // Function to make an address clickable
      function makeAddressClickable(address) {
        return `<a href="#" onclick="searchForAddress('${address}'); return false;" style="color: var(--primary-color); text-decoration: none; word-break: break-all;">${address}</a>`;
      }

      async function performSearch() {
        const query = document.getElementById("searchInput").value.trim();

        if (!query) {
          showMessage("Please enter a search term", "error");
          return;
        }

        if (!client) {
          showMessage("Please wait for network connection", "error");
          return;
        }

        const searchType = detectSearchType(query);

        if (searchType === "unknown") {
          showMessage(
            "Invalid format. Please enter a valid XRPL address (r...) or transaction hash",
            "error"
          );
          return;
        }

        showSearchPage(query, searchType);

        if (searchType === "address") {
          await searchAddress(query);
        } else if (searchType === "transaction") {
          await searchTransaction(query);
        }
      }

      async function searchAddress(address) {
        try {
          // Clear previous results
          document.getElementById("searchAccountDetailsResults").style.display =
            "none";
          document.getElementById(
            "searchTransactionHistoryResults"
          ).style.display = "none";
          document.getElementById(
            "searchTransactionDetailsResults"
          ).style.display = "none";

          // Show account details section
          document.getElementById("searchAccountDetailsTitle").textContent =
            "Account Details";
          document.getElementById(
            "searchAccountDetailsSubtitle"
          ).textContent = `Address: ${address}`;
          document.getElementById("searchAccountDetailsContent").innerHTML =
            '<div class="loading">Loading account information...</div>';
          document.getElementById("searchAccountDetailsResults").style.display =
            "block";

          // Get account info
          const accountInfo = await client.request({
            command: "account_info",
            account: address,
            ledger_index: "validated",
          });

          // Get account lines (trust lines)
          let accountLines = [];
          try {
            const linesResponse = await client.request({
              command: "account_lines",
              account: address,
              ledger_index: "validated",
            });
            accountLines = linesResponse.result.lines;
          } catch (e) {
            // Account might not have trust lines
          }

          const account = accountInfo.result.account_data;
          const balance = xrpl.dropsToXrp(account.Balance);

          let accountDetailsHtml = `
            <div class="account-info">
              <div class="info-item">
                <span class="info-label">Address:</span>
                <span class="info-value">${makeAddressClickable(address)}</span>
              </div>
              <div class="info-item">
                <span class="info-label">XRP Balance:</span>
                <span class="info-value">${balance} XRP</span>
              </div>
              <div class="info-item">
                <span class="info-label">Sequence:</span>
                <span class="info-value">${account.Sequence}</span>
              </div>
              <div class="info-item">
                <span class="info-label">Owner Count:</span>
                <span class="info-value">${account.OwnerCount}</span>
              </div>
              <div class="info-item">
                <span class="info-label">Reserve:</span>
                <span class="info-value">${xrpl.dropsToXrp(
                  account.Reserve || "0"
                )} XRP</span>
              </div>
          `;

          if (accountLines && accountLines.length > 0) {
            accountDetailsHtml += `
              <div class="info-item">
                <span class="info-label">Trust Lines:</span>
                <span class="info-value">${accountLines.length} lines</span>
              </div>
            `;

            accountLines.forEach((line, index) => {
              accountDetailsHtml += `
                <div class="info-item">
                  <span class="info-label">Token ${index + 1}:</span>
                  <span class="info-value">${line.balance} ${
                line.currency
              }</span>
                </div>
              `;
            });
          }

          accountDetailsHtml += "</div>";
          document.getElementById("searchAccountDetailsContent").innerHTML =
            accountDetailsHtml;

          // Get recent transactions
          try {
            document.getElementById(
              "searchTransactionHistorySubtitle"
            ).textContent = `Recent transactions for ${address}`;
            document.getElementById(
              "searchTransactionHistoryContent"
            ).innerHTML =
              '<div class="loading">Loading transaction history...</div>';
            document.getElementById(
              "searchTransactionHistoryResults"
            ).style.display = "block";

            const txResponse = await client.request({
              command: "account_tx",
              account: address,
              ledger_index_min: -1,
              ledger_index_max: -1,
              limit: 10,
              forward: false,
            });

            const recentTransactions = txResponse.result.transactions;

            if (recentTransactions && recentTransactions.length > 0) {
              let transactionHistoryHtml = '<div class="account-info">';

              recentTransactions.forEach((txWrapper, index) => {
                const tx = txWrapper.tx;
                const meta = txWrapper.meta;

                let direction = "";
                let amount = "";
                let amountClass = "";

                if (tx.TransactionType === "Payment") {
                  if (tx.Account === address) {
                    direction = "Sent";
                    amount = `-${xrpl.dropsToXrp(tx.Amount)} XRP`;
                    amountClass = "transaction-amount-negative";
                  } else if (tx.Destination === address) {
                    direction = "Received";
                    amount = `+${xrpl.dropsToXrp(tx.Amount)} XRP`;
                    amountClass = "transaction-amount-positive";
                  }
                }

                const status =
                  meta.TransactionResult === "tesSUCCESS"
                    ? "Success"
                    : "Failed";
                const statusClass =
                  meta.TransactionResult === "tesSUCCESS"
                    ? "status-success"
                    : "status-failed";

                // Format date
                const rippleEpochOffset = 946684800;
                const date = tx.date
                  ? new Date((tx.date + rippleEpochOffset) * 1000)
                  : new Date();

                transactionHistoryHtml += `
                  <div class="transaction-item">
                    <div class="transaction-header">
                      <div class="transaction-type">${
                        direction || tx.TransactionType
                      }</div>
                      <div class="transaction-date">${date.toLocaleString()}</div>
                    </div>
                    <div class="transaction-details">
                      <div class="transaction-detail">
                        <span class="transaction-label">Amount:</span>
                        <span class="transaction-value ${amountClass}">${
                  amount || "N/A"
                }</span>
                      </div>
                      <div class="transaction-detail">
                        <span class="transaction-label">Status:</span>
                        <span class="transaction-status ${statusClass}">${status}</span>
                      </div>
                      <div class="transaction-detail">
                        <span class="transaction-label">Hash:</span>
                        <span class="transaction-value">${
                          tx.hash
                            ? `<a href="#" onclick="searchForTransaction('${tx.hash}'); return false;" style="color: var(--primary-color); text-decoration: none; word-break: break-all;">${tx.hash}</a>`
                            : "N/A"
                        }</span>
                      </div>
                    </div>
                  </div>
                `;
              });

              transactionHistoryHtml += "</div>";
              document.getElementById(
                "searchTransactionHistoryContent"
              ).innerHTML = transactionHistoryHtml;
            } else {
              document.getElementById(
                "searchTransactionHistoryContent"
              ).innerHTML =
                '<div class="account-info"><div class="info-item"><span class="info-value">No transactions found for this account.</span></div></div>';
            }
          } catch (e) {
            document.getElementById(
              "searchTransactionHistoryContent"
            ).innerHTML =
              '<div class="account-info"><div class="info-item"><span class="info-value">Unable to load transaction history.</span></div></div>';
          }
        } catch (error) {
          console.error("Address search error:", error);
          if (error.data && error.data.error === "actNotFound") {
            document.getElementById("searchAccountDetailsContent").innerHTML =
              '<div class="account-info"><div class="info-item"><span class="info-value">Account not found. This address has not been activated on the XRPL network.</span></div></div>';
          } else {
            document.getElementById(
              "searchAccountDetailsContent"
            ).innerHTML = `<div class="account-info"><div class="info-item"><span class="info-value">Error: ${error.message}</span></div></div>`;
          }
        }
      }

      async function searchTransaction(txHash) {
        try {
          // Clear previous results
          document.getElementById("searchAccountDetailsResults").style.display =
            "none";
          document.getElementById(
            "searchTransactionHistoryResults"
          ).style.display = "none";
          document.getElementById(
            "searchTransactionDetailsResults"
          ).style.display = "none";

          // Show transaction details section
          document.getElementById("searchTransactionDetailsTitle").textContent =
            "Transaction Details";
          document.getElementById(
            "searchTransactionDetailsSubtitle"
          ).textContent = `Hash: ${txHash}`;
          document.getElementById("searchTransactionDetailsContent").innerHTML =
            '<div class="loading">Loading transaction details...</div>';
          document.getElementById(
            "searchTransactionDetailsResults"
          ).style.display = "block";

          const txResponse = await client.request({
            command: "tx",
            transaction: txHash,
          });

          const tx = txResponse.result;
          const meta = tx.meta;

          // Format date
          const rippleEpochOffset = 946684800;
          const date = tx.date
            ? new Date((tx.date + rippleEpochOffset) * 1000)
            : new Date();

          let resultHtml = `
            <div class="account-info">
              <div class="info-item">
                <span class="info-label">Transaction Hash:</span>
                <span class="info-value">${tx.hash}</span>
              </div>
              <div class="info-item">
                <span class="info-label">Type:</span>
                <span class="info-value">${tx.TransactionType}</span>
              </div>
              <div class="info-item">
                <span class="info-label">Status:</span>
                <span class="transaction-status ${
                  meta.TransactionResult === "tesSUCCESS"
                    ? "status-success"
                    : "status-failed"
                }">${
            meta.TransactionResult === "tesSUCCESS" ? "Success" : "Failed"
          }</span>
              </div>
              <div class="info-item">
                <span class="info-label">Date:</span>
                <span class="info-value">${date.toLocaleString()}</span>
              </div>
              <div class="info-item">
                <span class="info-label">Ledger Index:</span>
                <span class="info-value">#${tx.ledger_index}</span>
              </div>
              <div class="info-item">
                <span class="info-label">From Account:</span>
                <span class="info-value">${makeAddressClickable(
                  tx.Account
                )}</span>
              </div>
          `;

          if (tx.TransactionType === "Payment") {
            resultHtml += `
              <div class="info-item">
                <span class="info-label">To Account:</span>
                <span class="info-value">${makeAddressClickable(
                  tx.Destination
                )}</span>
              </div>
              <div class="info-item">
                <span class="info-label">Amount:</span>
                <span class="info-value">${xrpl.dropsToXrp(
                  tx.Amount
                )} XRP</span>
              </div>
            `;

            if (tx.DestinationTag !== undefined) {
              resultHtml += `
                <div class="info-item">
                  <span class="info-label">Destination Tag:</span>
                  <span class="info-value">${tx.DestinationTag}</span>
                </div>
              `;
            }
          }

          resultHtml += `
              <div class="info-item">
                <span class="info-label">Fee:</span>
                <span class="info-value">${xrpl.dropsToXrp(tx.Fee)} XRP</span>
              </div>
              <div class="info-item">
                <span class="info-label">Sequence:</span>
                <span class="info-value">${tx.Sequence}</span>
              </div>
            </div>
          `;

          document.getElementById("searchTransactionDetailsContent").innerHTML =
            resultHtml;
        } catch (error) {
          console.error("Transaction search error:", error);
          document.getElementById(
            "searchTransactionDetailsContent"
          ).innerHTML = `<div class="account-info"><div class="info-item"><span class="info-value">Transaction not found or error: ${error.message}</span></div></div>`;
        }
      }

      // Add enter key support for search
      document.addEventListener("DOMContentLoaded", function () {
        document
          .getElementById("searchInput")
          .addEventListener("keypress", function (e) {
            if (e.key === "Enter") {
              performSearch();
            }
          });
      });

      // Initialize ledger stream with placeholders
      function initializeLedgerStream() {
        const stream = document.getElementById("ledgerStream");
        stream.innerHTML = "";

        for (let i = 0; i < MAX_LEDGERS; i++) {
          const placeholder = document.createElement("div");
          placeholder.className = "ledger-placeholder";
          placeholder.textContent = "Waiting...";
          stream.appendChild(placeholder);
        }
      }

      // Add new ledger to the stream
      function addLedgerToStream(ledgerData) {
        const stream = document.getElementById("ledgerStream");

        // Create new ledger block
        const ledgerBlock = document.createElement("div");
        ledgerBlock.className = "ledger-block";

        const ledgerNumber = document.createElement("div");
        ledgerNumber.className = "ledger-number";
        ledgerNumber.textContent = `#${ledgerData.ledger_index}`;

        const ledgerHash = document.createElement("div");
        ledgerHash.className = "ledger-hash";
        ledgerHash.textContent = ledgerData.ledger_hash
          ? ledgerData.ledger_hash.substring(0, 12) + "..."
          : "N/A";

        const ledgerTime = document.createElement("div");
        ledgerTime.className = "ledger-time";
        ledgerTime.textContent = new Date().toLocaleTimeString();

        ledgerBlock.appendChild(ledgerNumber);
        ledgerBlock.appendChild(ledgerHash);
        ledgerBlock.appendChild(ledgerTime);

        // Add to beginning of stream
        if (stream.firstChild) {
          stream.insertBefore(ledgerBlock, stream.firstChild);
        } else {
          stream.appendChild(ledgerBlock);
        }

        // Remove excess blocks (keep only MAX_LEDGERS)
        const blocks = stream.children;
        if (blocks.length > MAX_LEDGERS) {
          // Add fade-out animation to the last block
          const lastBlock = blocks[blocks.length - 1];
          lastBlock.classList.add("fade-out");

          // Remove it after animation completes
          setTimeout(() => {
            if (lastBlock.parentNode) {
              lastBlock.remove();
            }
          }, 500);
        }

        // Update ledger history
        ledgerHistory.unshift(ledgerData);
        if (ledgerHistory.length > MAX_LEDGERS) {
          ledgerHistory.pop();
        }
      }

      // Subscribe to ledger stream
      function subscribeLedgerStream() {
        if (!client) return;

        try {
          client.request({
            command: "subscribe",
            streams: ["ledger"],
          });

          client.on("ledgerClosed", (ledger) => {
            console.log("New ledger:", ledger);
            addLedgerToStream(ledger);
          });
        } catch (error) {
          console.error("Error subscribing to ledger stream:", error);
        }
      }

      // Initialize XRPL client
      async function connectToNetwork() {
        try {
          updateStatus("Connecting to XRPL Network...", "connecting");

          // Connect to XRPL Mainnet
          client = new xrpl.Client("wss://s1.ripple.com/");
          await client.connect();

          updateStatus("Connected to XRPL Mainnet", "connected");
          showMessage("Successfully connected to XRPL network!", "success");

          // Subscribe to ledger stream
          subscribeLedgerStream();
        } catch (error) {
          updateStatus("Failed to connect to XRPL Network", "disconnected");
          showMessage("Error connecting to network: " + error.message, "error");
        }
      }

      // Derive address from secret key
      function deriveAddress() {
        const secretKey = document.getElementById("secretKey").value.trim();

        if (!secretKey) {
          showMessage("Please enter a secret key", "error");
          return;
        }

        try {
          // Create wallet from secret
          currentWallet = xrpl.Wallet.fromSeed(secretKey);

          const resultHtml = `
                    <div class="account-info">
                        <div class="info-item">
                            <span class="info-label">Address:</span>
                            <span class="info-value">${makeAddressClickable(
                              currentWallet.address
                            )}</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">Public Key:</span>
                            <span class="info-value">${
                              currentWallet.publicKey
                            }</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">Private Key:</span>
                            <div class="private-key-container">
                                <span class="info-value private-key-hidden" id="privateKeyValue">‚óè‚óè‚óè‚óè‚óè‚óè‚óè‚óè‚óè‚óè‚óè‚óè‚óè‚óè‚óè‚óè</span>
                                <button class="toggle-key-btn" onclick="togglePrivateKey()">Show</button>
                            </div>
                        </div>
                    </div>
                `;

          showAccountDetailsResults(resultHtml);
          showMessage("Address derived successfully!", "success");
        } catch (error) {
          showMessage("Error deriving address: " + error.message, "error");
        }
      }

      // Get account information from the ledger
      async function getAccountInfo() {
        if (!client) {
          showMessage("Please connect to the network first", "error");
          return;
        }

        if (!currentWallet) {
          showMessage("Please derive an address first", "error");
          return;
        }

        try {
          showMessage("Fetching account information...", "loading");
          console.log("Fetching account info for:", currentWallet.address);

          // Get account info
          const accountInfo = await client.request({
            command: "account_info",
            account: currentWallet.address,
            ledger_index: "validated",
          });

          console.log("Account Info:", accountInfo);

          // Get account lines (trust lines)
          let accountLines = null;
          try {
            const linesResponse = await client.request({
              command: "account_lines",
              account: currentWallet.address,
              ledger_index: "validated",
            });
            accountLines = linesResponse.result.lines;
          } catch (e) {
            // Account might not have trust lines
            accountLines = [];
          }

          const account = accountInfo.result.account_data;
          const balance = xrpl.dropsToXrp(account.Balance);

          let resultHtml = `
                    <div class="account-info">
                        <div class="info-item">
                            <span class="info-label">Address:</span>
                            <span class="info-value">${makeAddressClickable(
                              currentWallet.address
                            )}</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">XRP Balance:</span>
                            <span class="info-value">${balance} XRP</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">Sequence:</span>
                            <span class="info-value">${account.Sequence}</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">Owner Count:</span>
                            <span class="info-value">${
                              account.OwnerCount
                            }</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">Reserve:</span>
                            <span class="info-value">${xrpl.dropsToXrp(
                              account.Reserve || "0"
                            )} XRP</span>
                        </div>
                `;

          if (account.EmailHash) {
            resultHtml += `
                        <div class="info-item">
                            <span class="info-label">Email Hash:</span>
                            <span class="info-value">${account.EmailHash}</span>
                        </div>
                    `;
          }

          if (accountLines && accountLines.length > 0) {
            resultHtml += `
                        <div class="info-item">
                            <span class="info-label">Trust Lines:</span>
                            <span class="info-value">${accountLines.length} lines</span>
                        </div>
                    `;

            accountLines.forEach((line, index) => {
              resultHtml += `
                            <div class="info-item">
                                <span class="info-label">Token ${
                                  index + 1
                                }:</span>
                                <span class="info-value">${line.balance} ${
                line.currency
              }</span>
                            </div>
                        `;
            });
          }

          resultHtml += "</div>";

          showAccountDetailsResults(resultHtml);
          showMessage("Account information retrieved successfully!", "success");
        } catch (error) {
          console.log(error);
          if (error.data && error.data.error === "actNotFound") {
            showMessage(
              "Account not found. This address has not been activated on the XRPL network.",
              "error"
            );
          } else {
            showMessage(
              "Error fetching account info: " + error.message,
              "error"
            );
          }
        }
      }

      // Get transaction history for the current account
      async function getTransactionHistory() {
        if (!client) {
          showMessage("Please connect to the network first", "error");
          return;
        }

        if (!currentWallet) {
          showMessage("Please derive an address first", "error");
          return;
        }

        try {
          showMessage("Fetching transaction history...", "loading");
          console.log(
            "Fetching transaction history for:",
            currentWallet.address
          );

          // Get account transactions
          const transactions = await client.request({
            command: "account_tx",
            account: currentWallet.address,
            ledger_index_min: -1,
            ledger_index_max: -1,
            limit: 10,
            forward: false,
          });

          console.log("Transaction History:", transactions);

          const txList = transactions.result.transactions;

          if (!txList || txList.length === 0) {
            showTransactionHistoryResults(
              '<div class="account-info"><div class="info-item"><span class="info-value">No transactions found for this account.</span></div></div>'
            );
            showMessage("No transaction history found", "error");
            return;
          }

          let resultHtml = '<div class="account-info">';

          txList.forEach((txWrapper, index) => {
            const tx = txWrapper.tx;
            const meta = txWrapper.meta;
            const ledgerIndex = txWrapper.ledger_index;

            // Determine transaction type and direction
            let txType = tx.TransactionType;
            let direction = "";
            let amount = "";
            let counterparty = "";
            let amountClass = "";

            if (txType === "Payment") {
              if (tx.Account === currentWallet.address) {
                direction = "Sent";
                counterparty = tx.Destination;
                amount = `-${xrpl.dropsToXrp(tx.Amount)} XRP`;
                amountClass = "transaction-amount-negative";
              } else if (tx.Destination === currentWallet.address) {
                direction = "Received";
                counterparty = tx.Account;
                amount = `+${xrpl.dropsToXrp(tx.Amount)} XRP`;
                amountClass = "transaction-amount-positive";
              }
            }

            const status =
              meta.TransactionResult === "tesSUCCESS" ? "Success" : "Failed";
            const statusClass =
              meta.TransactionResult === "tesSUCCESS"
                ? "status-success"
                : "status-failed";

            // Format date (XRPL uses Ripple Epoch - seconds since January 1, 2000 00:00 GMT)
            const rippleEpochOffset = 946684800; // Unix timestamp of Ripple epoch
            const date = tx.date
              ? new Date((tx.date + rippleEpochOffset) * 1000)
              : new Date();

            resultHtml += `
              <div class="transaction-item">
                <div class="transaction-header">
                  <div class="transaction-type">${direction || txType}</div>
                  <div class="transaction-date">${date.toLocaleString()}</div>
                </div>
                <div class="transaction-details">
                  <div class="transaction-detail">
                    <span class="transaction-label">Amount:</span>
                    <span class="transaction-value ${amountClass}">${
              amount || "N/A"
            }</span>
                  </div>
                  <div class="transaction-detail">
                    <span class="transaction-label">Status:</span>
                    <span class="transaction-status ${statusClass}">${status}</span>
                  </div>
                  <div class="transaction-detail">
                    <span class="transaction-label">Hash:</span>
                    <span class="transaction-value">${
                      tx.hash
                        ? `<a href="#" onclick="searchForTransaction('${tx.hash}'); return false;" style="color: var(--primary-color); text-decoration: none; word-break: break-all;">${tx.hash}</a>`
                        : "N/A"
                    }</span>
                  </div>
                  <div class="transaction-detail">
                    <span class="transaction-label">Ledger:</span>
                    <span class="transaction-value">#${ledgerIndex}</span>
                  </div>
            `;

            if (counterparty) {
              resultHtml += `
                  <div class="transaction-detail">
                    <span class="transaction-label">${
                      direction === "Sent" ? "To:" : "From:"
                    }</span>
                    <span class="transaction-value">${makeAddressClickable(
                      counterparty
                    )}</span>
                  </div>
              `;
            }

            if (tx.DestinationTag !== undefined) {
              resultHtml += `
                  <div class="transaction-detail">
                    <span class="transaction-label">Dest Tag:</span>
                    <span class="transaction-value">${tx.DestinationTag}</span>
                  </div>
              `;
            }

            if (tx.Fee) {
              resultHtml += `
                  <div class="transaction-detail">
                    <span class="transaction-label">Fee:</span>
                    <span class="transaction-value">${xrpl.dropsToXrp(
                      tx.Fee
                    )} XRP</span>
                  </div>
              `;
            }

            resultHtml += `
                </div>
              </div>
            `;
          });

          resultHtml += "</div>";

          showTransactionHistoryResults(resultHtml);
          showMessage(`Found ${txList.length} recent transactions`, "success");
        } catch (error) {
          console.error("Transaction history error:", error);
          if (error.data && error.data.error === "actNotFound") {
            showMessage(
              "Account not found. This address has not been activated on the XRPL network.",
              "error"
            );
          } else {
            showMessage(
              "Error fetching transaction history: " + error.message,
              "error"
            );
          }
        }
      }

      // Send XRP payment
      async function sendPayment() {
        if (!client) {
          showMessage("Please connect to the network first", "error");
          return;
        }

        if (!currentWallet) {
          showMessage("Please derive an address first", "error");
          return;
        }

        const destinationAddress = document
          .getElementById("destinationAddress")
          .value.trim();
        const amount = document.getElementById("amount").value.trim();
        const destinationTag = document
          .getElementById("destinationTag")
          .value.trim();

        // Validation
        if (!destinationAddress) {
          showMessage("Please enter a destination address", "error");
          return;
        }

        if (!amount || parseFloat(amount) <= 0) {
          showMessage("Please enter a valid amount greater than 0", "error");
          return;
        }

        // Validate destination address format
        if (
          !destinationAddress.startsWith("r") ||
          destinationAddress.length < 25
        ) {
          showMessage("Invalid destination address format", "error");
          return;
        }

        try {
          showMessage("Preparing payment transaction...", "loading");

          // Prepare payment transaction
          const payment = {
            TransactionType: "Payment",
            Account: currentWallet.address,
            Amount: xrpl.xrpToDrops(amount),
            Destination: destinationAddress,
          };

          // Add destination tag if provided
          if (destinationTag && parseInt(destinationTag) >= 0) {
            payment.DestinationTag = parseInt(destinationTag);
          }

          console.log("Payment object:", payment);

          // Auto-fill transaction details
          const prepared = await client.autofill(payment);
          console.log("Prepared payment:", prepared);

          // Sign the transaction
          const signed = currentWallet.sign(prepared);
          console.log("Signed payment:", signed);

          showMessage("Submitting payment to XRPL network...", "loading");

          // Submit the transaction
          const result = await client.submitAndWait(signed.tx_blob);
          console.log("Transaction result:", result);

          if (result.result.meta.TransactionResult === "tesSUCCESS") {
            const resultHtml = `
              <div class="account-info">
                <div class="info-item">
                  <span class="info-label">Transaction Hash:</span>
                  <span class="info-value">${result.result.hash}</span>
                </div>
                <div class="info-item">
                  <span class="info-label">From:</span>
                  <span class="info-value">${makeAddressClickable(
                    currentWallet.address
                  )}</span>
                </div>
                <div class="info-item">
                  <span class="info-label">To:</span>
                  <span class="info-value">${makeAddressClickable(
                    destinationAddress
                  )}</span>
                </div>
                <div class="info-item">
                  <span class="info-label">Amount:</span>
                  <span class="info-value">${amount} XRP</span>
                </div>
                ${
                  destinationTag
                    ? `
                <div class="info-item">
                  <span class="info-label">Destination Tag:</span>
                  <span class="info-value">${destinationTag}</span>
                </div>
                `
                    : ""
                }
                <div class="info-item">
                  <span class="info-label">Fee:</span>
                  <span class="info-value">${xrpl.dropsToXrp(
                    prepared.Fee
                  )} XRP</span>
                </div>
                <div class="info-item">
                  <span class="info-label">Status:</span>
                  <span class="info-value">Success</span>
                </div>
              </div>
            `;

            showPaymentResults(resultHtml);
            showMessage("Payment sent successfully!", "success");

            // Clear payment form
            document.getElementById("destinationAddress").value = "";
            document.getElementById("amount").value = "";
            document.getElementById("destinationTag").value = "";
          } else {
            showMessage(
              `Payment failed: ${result.result.meta.TransactionResult}`,
              "error"
            );
          }
        } catch (error) {
          console.error("Payment error:", error);
          if (error.data && error.data.error_message) {
            showMessage(`Payment failed: ${error.data.error_message}`, "error");
          } else {
            showMessage(`Payment failed: ${error.message}`, "error");
          }
        }
      }

      // Utility functions
      function showAccountDetailsResults(html) {
        document.getElementById("accountDetailsContent").innerHTML = html;
        document.getElementById("accountDetailsResults").style.display =
          "block";
      }

      function showTransactionHistoryResults(html) {
        document.getElementById("transactionHistoryContent").innerHTML = html;
        document.getElementById("transactionHistoryResults").style.display =
          "block";
      }

      function showAccountResults(html) {
        // Legacy function - redirect to account details results
        showAccountDetailsResults(html);
      }

      function showPaymentResults(html) {
        document.getElementById("paymentResultContent").innerHTML = html;
        document.getElementById("paymentResults").style.display = "block";
      }

      function showResults(html) {
        // Legacy function - redirect to account details results
        showAccountDetailsResults(html);
      }

      function togglePrivateKey() {
        if (!currentWallet) return;

        const privateKeyElement = document.getElementById("privateKeyValue");
        const toggleButton = document.querySelector(".toggle-key-btn");

        if (privateKeyElement.textContent === "‚óè‚óè‚óè‚óè‚óè‚óè‚óè‚óè‚óè‚óè‚óè‚óè‚óè‚óè‚óè‚óè") {
          privateKeyElement.textContent = currentWallet.privateKey;
          privateKeyElement.className = "info-value";
          toggleButton.textContent = "Hide";
        } else {
          privateKeyElement.textContent = "‚óè‚óè‚óè‚óè‚óè‚óè‚óè‚óè‚óè‚óè‚óè‚óè‚óè‚óè‚óè‚óè";
          privateKeyElement.className = "info-value private-key-hidden";
          toggleButton.textContent = "Show";
        }
      }

      function showMessage(message, type) {
        const existingMessage = document.querySelector(
          ".error, .success, .loading"
        );
        if (existingMessage) {
          existingMessage.remove();
        }

        const messageDiv = document.createElement("div");
        messageDiv.className = type;
        messageDiv.textContent = message;

        const container = document.querySelector(".container");
        container.appendChild(messageDiv);

        if (type !== "loading") {
          setTimeout(() => {
            if (messageDiv.parentNode) {
              messageDiv.remove();
            }
          }, 5000);
        }
      }

      function updateStatus(message, status) {
        const statusElement = document.getElementById("networkStatus");
        const statusIndicator = document.getElementById("statusIndicator");
        const statusText = document.getElementById("statusText");

        statusText.textContent = message;

        // Update indicator and status class
        statusIndicator.className = "status-indicator";

        switch (status) {
          case "connected":
            statusElement.className = "network-status connected";
            statusIndicator.classList.add("status-green");
            break;
          case "connecting":
            statusElement.className = "network-status disconnected";
            statusIndicator.classList.add("status-red");
            break;
          case "disconnected":
          default:
            statusElement.className = "network-status disconnected";
            statusIndicator.classList.add("status-red");
            break;
        }
      }

      function clearResults() {
        document.getElementById("accountDetailsResults").style.display = "none";
        document.getElementById("accountDetailsContent").innerHTML = "";
        document.getElementById("transactionHistoryResults").style.display =
          "none";
        document.getElementById("transactionHistoryContent").innerHTML = "";
        document.getElementById("paymentResults").style.display = "none";
        document.getElementById("paymentResultContent").innerHTML = "";

        const messages = document.querySelectorAll(
          ".error, .success, .loading"
        );
        messages.forEach((msg) => msg.remove());
      }

      // Auto-connect on page load
      window.addEventListener("load", async () => {
        // Initialize ledger stream with placeholders
        initializeLedgerStream();

        // Check URL parameters first
        const params = new URLSearchParams(window.location.search);
        const query = params.get("q");
        const type = params.get("type");

        // Auto-connect when page loads
        await connectToNetwork();

        // After connection, initialize page state
        if (query && type) {
          // Only show loading for search pages
          showPageLoading();
          document.getElementById("searchInput").value = query;
          showSearchPage(query, type);
          hidePageLoading();
          // Wait for client to be ready before making API calls
          waitForClientAndSearch(query, type);
        } else {
          // Show home page directly without loading animation
          showHomePage();
        }
      });
    </script>
  </body>
</html>
